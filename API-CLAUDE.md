# Claude Guidance: Hello World API

## Project Overview

**What**: Hello World API — a minimal ASP.NET Core Minimal APIs project demonstrating specification-first development using the SCRIBE methodology. Implements a single POST `/test/hello` endpoint returning a JSON hello world message.

**Why**: To serve as the canonical working example produced by the SCRIBE methodology. This project was generated entirely from markdown specifications by executing `IMPLEMENTATION-PROMPT.md` — no code was written manually.

**Tech Stack**:
- **Framework**: ASP.NET Core Minimal APIs
- **Runtime**: .NET 8 LTS (SDK 8.0.405, locked via `global.json`)
- **Testing**: xUnit with `WebApplicationFactory<Program>` for in-process integration tests
- **OpenAPI**: Swashbuckle (Swagger UI available in development)
- **Platform**: macOS ARM64 (Apple Silicon) — verify with `dotnet --info`

**Scope**: Phase 1 — single endpoint `POST /test/hello` returning `{"message":"hello world"}`. Designed to grow to 10+ endpoints in Phase 3 without architectural changes.

**Relationship to SCRIBE**: This project is a *generated artefact*. The methodology is documented in `CLAUDE.md` and `README.md`. This file (`API-CLAUDE.md`) was generated by `IMPLEMENTATION-PROMPT.md` Part 5 and is specific to this generated project.

---

## Getting Started for Claude

### Quick Context
This project follows specification-first development. All requirements are documented in `/docs/` before any code exists. Code is generated from specs — never the other way around. If you need to understand *why* something is built a certain way, read the spec files in `/docs/specs/` first.

### Key Terminal Commands
```bash
dotnet build                                        # Compile the project
dotnet run --project src                            # Start API server (http://localhost:5000)
dotnet test                                         # Run all 13 xUnit tests
dotnet test --verbosity normal                      # Run tests with named output
dotnet test --filter "PostHello_WithValidRequest"   # Run specific test(s)
dotnet clean                                        # Clean build artifacts
dotnet restore                                      # Restore NuGet packages
```

### Verify the API is Running
```bash
curl -X POST http://localhost:5000/test/hello
# Expected: {"message":"hello world"}

curl -X POST http://localhost:5000/test/hello -H "Content-Type: application/json"
# Expected: {"message":"hello world"}
```

### Configuration Files
- **`global.json`** — Locks .NET SDK to version `8.0.405`. Do not change this without team alignment.
- **`hello-world-api.sln`** — Solution file referencing both `src/` and `tests/` projects.
- **`src/HelloWorldApi.csproj`** — Targets `net8.0`; references `Microsoft.AspNetCore.OpenApi` and `Swashbuckle.AspNetCore`.
- **`tests/HelloWorldApi.Tests.csproj`** — xUnit test project using `WebApplicationFactory<Program>`.

### Documentation Navigation
- [Hello Endpoint Spec](./docs/specs/hello-endpoint.md) — Full contract for `POST /test/hello`
- [API Design Principles](./docs/specs/api-design.md) — Endpoint design standards and naming
- [Error Handling Spec](./docs/specs/error-handling.md) — Error envelope format and HTTP codes
- [Technology Choices](./docs/specs/technology-choices.md) — Why ASP.NET Core, .NET 8, xUnit
- [Getting Started Guide](./docs/guides/getting-started.md) — Human-oriented setup guide
- [Adding Endpoints Guide](./docs/guides/adding-endpoints.md) — Workflow for new endpoints
- [ADR-001: Minimal APIs](./docs/adr/adr-001-minimal-apis.md) — Why Minimal APIs over MVC

---

## Coding Standards

### C# and .NET Conventions
- **Naming**: PascalCase for classes and public members (`HelloHandler`, `PostTestHello`); camelCase for local variables
- **File organisation**: One public class per file; the `HelloHandler` static class lives in `Program.cs` for Phase 1 simplicity — move to dedicated files as endpoints grow
- **Async**: All HTTP handler methods should be `async Task<IResult>` as endpoints grow; current `PostTestHello` is synchronous (acceptable for Phase 1)
- **Null safety**: Nullable reference types are enabled (`<Nullable>enable</Nullable>`) — always handle nulls explicitly
- **Using statements**: Implicit usings are enabled; add explicit usings only when needed

### Endpoint Pattern
All endpoints follow the handler pattern established in `Program.cs`:
```csharp
// 1. Register in Program.cs
app.MapPost("/test/hello", HelloHandler.PostTestHello)
    .WithName("PostTestHello")
    .WithOpenApi()
    .Produces(200)
    .Produces(500);

// 2. Implement as static method on a Handler class
public static class HelloHandler
{
    public static IResult PostTestHello()
    {
        try { return Results.Ok(new { message = "hello world" }); }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"Unhandled exception: {ex.Message}");
            return Results.Json(new { error = new { code = "INTERNAL_SERVER_ERROR", message = "An unexpected error occurred" } }, statusCode: 500);
        }
    }
}
```

### Testing with xUnit
- **Test class naming**: `{FeatureName}Tests` — e.g., `HelloEndpointTests`
- **Test method naming**: `{MethodName}_{Scenario}_{Expected}` — e.g., `PostHello_WithValidRequest_ReturnsOkWithMessage`
- **Test infrastructure**: Use `WebApplicationFactory<Program>` with `IAsyncLifetime` for in-process integration tests (no separate server needed)
- **Parameterised tests**: Use `[Theory]` + `[InlineData]` for multiple scenarios
- **Async**: Always `public async Task`, never `public async void`
- **Assertions**: xUnit `Assert` class only — `Assert.Equal`, `Assert.True`, `Assert.False`, `Assert.NotNull`
- **13 tests currently passing** — do not reduce this count when adding features; only add new tests

### Error Handling
- All endpoints must wrap logic in try/catch
- Success: `Results.Ok(new { ... })` — HTTP 200 with JSON body
- Server error: `Results.Json(new { error = new { code = "INTERNAL_SERVER_ERROR", message = "..." } }, statusCode: 500)`
- Validation error: HTTP 400 with `code = "INVALID_REQUEST"` (see [Error Handling Spec](./docs/specs/error-handling.md))
- Never return plain text or HTML — always JSON

### Git Workflow
- Commit messages are descriptive: `"Add POST /users/login endpoint"` not `"Update code"`
- One logical change per commit
- Spec file must exist before implementation (specification-first)

---

## Key Workflow: Adding New Endpoints

### Step 1: Write the Specification
Create `/docs/specs/{endpoint-name}.md` following the pattern in `hello-endpoint.md`:
- Endpoint: HTTP method + path
- Purpose: one-line description
- Request Contract: method, URL, headers, body
- Response Contract — Success: HTTP status + JSON structure + example
- Response Contract — Error: HTTP status + error codes
- Examples: real curl commands with expected output

### Step 2: Register in the Endpoint Index
Add an entry to [API Design — Endpoint Index](./docs/specs/api-design.md) with status: `Active`, `Planned`, or `Deprecated`.

### Step 3: Implement the Handler
1. Create or extend a `{Feature}Handler` static class in `/src/`
2. Implement the method following the handler pattern above
3. Register the route in `Program.cs` with `.WithName()`, `.WithOpenApi()`, `.Produces()`

### Step 4: Write the Tests
1. Create `/tests/{Feature}Tests.cs`
2. Use `WebApplicationFactory<Program>` via the `IAsyncLifetime` pattern (copy from `HelloEndpointTests.cs`)
3. Write `[Fact]` tests for: success (200), validation error (400), server error (500), edge cases
4. Run `dotnet test` — all tests must pass before considering the endpoint complete

### Step 5: Update Guides (if needed)
If the endpoint requires special setup or configuration, update `/docs/guides/` accordingly.

---

## Important Gotchas

### macOS ARM64
- Always verify `dotnet --info` shows `Architecture: arm64`, NOT `x86_64`
- x64 emulation causes 30–50% performance degradation and subtle build issues
- If emulation is detected, reinstall the .NET 8 SDK for Apple Silicon from [dotnet.microsoft.com](https://dotnet.microsoft.com/download/dotnet/8.0)

### SDK Version Lock
- `global.json` pins to SDK `8.0.405` exactly — running on a different patch version may cause warnings or subtle issues
- Check your installed version: `dotnet --info`
- If your version differs, either install `8.0.405` or update `global.json` (team decision required)

### `public partial class Program {}`
- This line at the bottom of `Program.cs` is **not optional** — it makes `Program` visible to `WebApplicationFactory<Program>` in the test project
- Do not remove it when refactoring

### xUnit Async Tests
- Always `public async Task`, never `public async void`
- Exceptions in `async void` are uncatchable — xUnit will silently swallow them
- `IAsyncLifetime` (`InitializeAsync`/`DisposeAsync`) is the correct pattern for async test setup/teardown

### JSON Response Format
- Always return JSON — never plain text or HTML
- The exact response for `POST /test/hello` is `{"message":"hello world"}` (no spaces, lowercase)
- Tests assert the exact string — any formatting change will break `PostHello_ResponseBodyIsValidJson`

### Swagger UI
- Only available in Development environment (`app.Environment.IsDevelopment()`)
- Access at `http://localhost:5000/swagger/index.html` while server is running
- Not available in Production builds by design

---

## Links to Detailed Documentation

### Specifications
- [Hello Endpoint Contract](./docs/specs/hello-endpoint.md) — `POST /test/hello` full specification
- [API Design Principles](./docs/specs/api-design.md) — Endpoint design standards and endpoint index
- [Error Handling Specification](./docs/specs/error-handling.md) — Error envelope format, HTTP codes, error code registry
- [Technology Choices](./docs/specs/technology-choices.md) — Framework, runtime, and testing framework decisions

### Guides
- [Getting Started](./docs/guides/getting-started.md) — Full setup guide for humans (prerequisites, clone, build, run, test)
- [Adding Endpoints](./docs/guides/adding-endpoints.md) — Step-by-step workflow for adding new endpoints

### Architecture Decisions
- [ADR-001: Minimal APIs](./docs/adr/adr-001-minimal-apis.md) — Why Minimal APIs over MVC Controller pattern

---

## Document Metadata

- **Version**: 1.0 (Phase 1 — generated by IMPLEMENTATION-PROMPT.md Part 5)
- **Last Updated**: 2026-02-18
- **Audience**: Claude Code agents working on the generated Hello World API project
- **Generated By**: `IMPLEMENTATION-PROMPT.md` — regeneratable; removed by `restoration-prompt.md`
- **Methodology Guidance**: See [`CLAUDE.md`](./CLAUDE.md) for the repository-level SCRIBE methodology context
- **Human Quick Start**: See [`docs/guides/getting-started.md`](./docs/guides/getting-started.md)
